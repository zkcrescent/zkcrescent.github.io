<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redis | zkcrescent 的木屋</title>
    <meta name="description" content="一个莫得感情的代码工具人">
    
    
    <link rel="preload" href="/assets/css/0.styles.5ba0d270.css" as="style"><link rel="preload" href="/assets/js/app.4a6d56ca.js" as="script"><link rel="preload" href="/assets/js/2.6d9f343b.js" as="script"><link rel="preload" href="/assets/js/23.f37b6506.js" as="script"><link rel="prefetch" href="/assets/js/10.aeb3a94d.js"><link rel="prefetch" href="/assets/js/11.bc285247.js"><link rel="prefetch" href="/assets/js/12.1f8a932c.js"><link rel="prefetch" href="/assets/js/13.2e687e55.js"><link rel="prefetch" href="/assets/js/14.6564caa9.js"><link rel="prefetch" href="/assets/js/15.35a1f34f.js"><link rel="prefetch" href="/assets/js/16.8823e3cf.js"><link rel="prefetch" href="/assets/js/17.9eebf3ea.js"><link rel="prefetch" href="/assets/js/18.0a3a8d8c.js"><link rel="prefetch" href="/assets/js/19.02ecbbb8.js"><link rel="prefetch" href="/assets/js/20.1be9c3bd.js"><link rel="prefetch" href="/assets/js/21.898d9aec.js"><link rel="prefetch" href="/assets/js/22.83bb4cae.js"><link rel="prefetch" href="/assets/js/24.83ecb85a.js"><link rel="prefetch" href="/assets/js/25.0861b7e9.js"><link rel="prefetch" href="/assets/js/26.ac02f568.js"><link rel="prefetch" href="/assets/js/3.814f06c8.js"><link rel="prefetch" href="/assets/js/4.da136bfd.js"><link rel="prefetch" href="/assets/js/5.d8996a38.js"><link rel="prefetch" href="/assets/js/6.24a1903b.js"><link rel="prefetch" href="/assets/js/7.05bc1c19.js"><link rel="prefetch" href="/assets/js/8.3b3862c5.js"><link rel="prefetch" href="/assets/js/9.da2769e8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5ba0d270.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container vuepress-theme-simple"><header class="header"><a href="/" title="一个莫得感情的代码工具人" class="site-name router-link-active">zkcrescent 的木屋</a><div style="clear: both"></div><div class="navbar"><span><a href="/components/technic/golang/main.html" class="navbar-item">GoLang 相关</a><!----></span><span><a href="/components/technic/os/main.html" class="navbar-item">OS 相关</a><!----></span><span><a href="/components/technic/store/main.html" class="navbar-item">存储相关</a><!----></span><span><a href="/components/technic/game/main.html" class="navbar-item">游戏相关</a><!----></span><span><a href="/components/technic/link.html" class="navbar-item">知识链接</a><!----></span><span><a href="/intro.html" class="navbar-item">关于</a><!----></span></div></header><section class="post-view"><div class="post-head"><h1 class="post-title">Redis</h1><time datetime="8/10/2021" title="8/10/2021" pubdate="pubdate" class="post-date">
  10 minutes ago
</time></div><div class="content__default"><h1 id="redis"><a href="#redis" aria-hidden="true" class="header-anchor">#</a> redis</h1> <h2 id="通信协议"><a href="#通信协议" aria-hidden="true" class="header-anchor">#</a> 通信协议</h2> <p>客户端与服务端使用的通信协议， 特点：<code>实现简单，解析快，良好可读性</code></p> <ul><li><code>+</code> 表示正确的状态，信息紧跟</li> <li><code>-</code> 表示错误状态, 信息紧跟</li> <li><code>*</code> 消息体有多少段</li> <li><code>$</code> 下一行长度</li> <li><code>:</code> 返回值，后面跟</li></ul> <h2 id="数据结构"><a href="#数据结构" aria-hidden="true" class="header-anchor">#</a> 数据结构</h2> <ul><li>string(二进制安全，最大512M，原因（没有找到具体说明，纯属个人臆断）：可能是因为长度(bit)使用的u32定义，所以最大是2^32，512M)</li> <li>list(链表，最大2^32-1个元素)</li> <li>hash map</li> <li>set(无序集合，hash 实现，数据唯一)</li> <li>zset（有序集合，hash 实现，通过double类型的分数决定排位）</li></ul> <h2 id="key-和-value-长度影响"><a href="#key-和-value-长度影响" aria-hidden="true" class="header-anchor">#</a> Key 和 Value 长度影响</h2> <ul><li>均只能在512M以内(u32定义)</li> <li>Key 最好不超过1024 字节，原因在于不仅内存资源占用更多，字符搜索和对比需要更多的时间</li> <li>Key 特别短也不建议比如u100flw，建议使用可读性更好的Key, 比如 user:1000:followers</li></ul> <h2 id="性能"><a href="#性能" aria-hidden="true" class="header-anchor">#</a> 性能</h2> <p>10W+ QPS</p> <p>随连接数增加而降低</p> <h2 id="持久化"><a href="#持久化" aria-hidden="true" class="header-anchor">#</a> 持久化</h2> <h3 id="rdb"><a href="#rdb" aria-hidden="true" class="header-anchor">#</a> RDB</h3> <p>redis database, 默认方式，存储数据</p> <h3 id="aof"><a href="#aof" aria-hidden="true" class="header-anchor">#</a> AOF</h3> <p>append only file, 根据条件将 aof_buf 中的缓存写入 aof 文件，再根据一定条件 调用 fsync 写入磁盘，存储 <code>通信协议</code> 命令文本</p> <h3 id="差异"><a href="#差异" aria-hidden="true" class="header-anchor">#</a> 差异</h3> <ol><li>aof文件比rdb更新频率高，优先使用aof还原数据</li> <li>aof比rdb更安全，但文件更大</li> <li>rdb性能比aof好</li> <li>如果两个都配了优先加载AOF</li></ol> <h2 id="其他"><a href="#其他" aria-hidden="true" class="header-anchor">#</a> 其他</h2> <h3 id="一致性-hash-算法-（常用的hash-分片存储方式）"><a href="#一致性-hash-算法-（常用的hash-分片存储方式）" aria-hidden="true" class="header-anchor">#</a> 一致性 HASH 算法 （常用的HASH 分片存储方式）</h3> <p>将存储节点hash后放到一个圆上，然后将数据也hash后放到圆上，顺时针遇到的第一个节点就是数据存储节点</p> <p>掉点或者增加节点只会影响顺时针后的下一个节点的数据，其他节点没有影响</p> <h3 id="hash-槽-redis-官方集群分片方式"><a href="#hash-槽-redis-官方集群分片方式" aria-hidden="true" class="header-anchor">#</a> hash 槽 (REDIS  官方集群分片方式)</h3> <p>redis 集群中，一共 2 ^ 14 （16384）个槽位，每个MASTER节点拥有一个槽位区间（why 2^14?）</p> <p>存储: key 根据crc-16(16位冗余校验) % 2 ^ 14 的值判断进入哪个槽区，从而知道在哪个节点</p> <p><img src="/img/redis-slot.jpeg" alt="SLOT"></p></div><div class="list-item"><div class="divider"></div><div class="post-footer">&lt;- back</div><div class="post-footer">&lt;- back to home</div></div></section><footer class="footer">
  © 2021
  <!---->
  
  <br>
  Powered by
  <a href="https://vuepress.vuejs.org/" rel="noopener" target="_blank">VuePress</a>
  | Theme, Customized from
  <a href="https://github.com/viko16/vuepress-theme-simple" rel="noopener" target="_blank">Simple</a></footer></div><!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4a6d56ca.js" defer></script><script src="/assets/js/2.6d9f343b.js" defer></script><script src="/assets/js/23.f37b6506.js" defer></script>
  </body>
</html>
