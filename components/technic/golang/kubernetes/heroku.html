<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Heroku | zkcrescent 的木屋</title>
    <meta name="description" content="一个莫得感情的代码工具人">
    
    
    <link rel="preload" href="/assets/css/0.styles.5ba0d270.css" as="style"><link rel="preload" href="/assets/js/app.52eaae7e.js" as="script"><link rel="preload" href="/assets/js/2.6d9f343b.js" as="script"><link rel="preload" href="/assets/js/13.79df7d96.js" as="script"><link rel="prefetch" href="/assets/js/10.21abb8b0.js"><link rel="prefetch" href="/assets/js/11.50f2c43c.js"><link rel="prefetch" href="/assets/js/12.26a02888.js"><link rel="prefetch" href="/assets/js/14.cd7ca4fd.js"><link rel="prefetch" href="/assets/js/15.0b5572e4.js"><link rel="prefetch" href="/assets/js/16.b849a9fe.js"><link rel="prefetch" href="/assets/js/17.9ebfd29d.js"><link rel="prefetch" href="/assets/js/18.1423e777.js"><link rel="prefetch" href="/assets/js/19.4815dfb7.js"><link rel="prefetch" href="/assets/js/20.367539e2.js"><link rel="prefetch" href="/assets/js/21.f0ad3303.js"><link rel="prefetch" href="/assets/js/22.d8d03564.js"><link rel="prefetch" href="/assets/js/23.81f497ef.js"><link rel="prefetch" href="/assets/js/24.000e4ca0.js"><link rel="prefetch" href="/assets/js/25.a6cc947f.js"><link rel="prefetch" href="/assets/js/26.971ebe23.js"><link rel="prefetch" href="/assets/js/27.7f12229e.js"><link rel="prefetch" href="/assets/js/28.d0316184.js"><link rel="prefetch" href="/assets/js/3.814f06c8.js"><link rel="prefetch" href="/assets/js/4.da136bfd.js"><link rel="prefetch" href="/assets/js/5.d8996a38.js"><link rel="prefetch" href="/assets/js/6.24a1903b.js"><link rel="prefetch" href="/assets/js/7.9f0f5d1d.js"><link rel="prefetch" href="/assets/js/8.74172104.js"><link rel="prefetch" href="/assets/js/9.55e18633.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5ba0d270.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container vuepress-theme-simple"><header class="header"><a href="/" title="一个莫得感情的代码工具人" class="site-name router-link-active">zkcrescent 的木屋</a><div style="clear: both"></div><div class="navbar"><span><a href="/components/technic/golang/main.html" class="navbar-item">GoLang 相关</a><!----></span><span><a href="/components/technic/os/main.html" class="navbar-item">OS 相关</a><!----></span><span><a href="/components/technic/store/main.html" class="navbar-item">存储相关</a><!----></span><span><a href="/components/technic/dataStructure/main.html" class="navbar-item">数据结构</a><!----></span><span><a href="/components/technic/link.html" class="navbar-item">知识链接</a><!----></span><span><a href="/intro.html" class="navbar-item">关于</a><!----></span></div></header><section class="post-view"><div class="post-head"><h1 class="post-title">Heroku</h1><time datetime="9/10/2019" title="9/10/2019" pubdate="pubdate" class="post-date">
  1 year ago
</time></div><div class="content__default"><h1 id="heroku"><a href="#heroku" aria-hidden="true" class="header-anchor">#</a> Heroku</h1> <p>美国的一家做PaaS的公司，产品很有特色，初次接触的人会容易被它提供服务的特点惊艳到 <em>(:зゝ∠)</em></p> <h2 id="特点-新颖点"><a href="#特点-新颖点" aria-hidden="true" class="header-anchor">#</a> 特点 + 新颖点</h2> <h3 id="登录"><a href="#登录" aria-hidden="true" class="header-anchor">#</a> 登录</h3> <p>和传统的CLI登录方式有所区别的是，当使用 heroku cli 登录时，会弹出浏览器窗口直接点击即可登录，很有特色</p> <h3 id="dataclips（挺有用的）"><a href="#dataclips（挺有用的）" aria-hidden="true" class="header-anchor">#</a> <a href="https://devcenter.heroku.com/articles/dataclips" target="_blank" rel="noopener noreferrer">DataClips<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（挺有用的）</h3> <p>可以通过共享Query方式实现共享你在heroku中的存储数据（各种 stroe add-on）</p> <h3 id="dynos-测力计"><a href="#dynos-测力计" aria-hidden="true" class="header-anchor">#</a> Dynos (测力计)</h3> <p>heroku 中，app 对应的一个容器集合叫做 dynos, 管理 APP 的runtime，容器资源限制也是从 dynos 中控制的, heroku 提供了6个标准的 dynos 类型，规定了基本的配置，
中间有几个指标比较在意</p> <ol><li>preboot</li> <li>Number of process types</li> <li>Language runtime metric</li> <li>没有确切CPU多少的说明，文档中有规格大概是2:5X（1C）免费的是1x-4x</li> <li>企业专用 dynos 提供 auto scaling</li></ol> <p>水平扩展增加数量，垂直伸展换配置</p> <p>auto scaling: p95 Response Time: 过去一小时内百分之95的请求平均时间，周期触发，最小一分钟，触发如果超过水位线，将会调度或者杀掉一个实例</p> <h3 id="stack"><a href="#stack" aria-hidden="true" class="header-anchor">#</a> stack</h3> <p>执行的 os base image,可以指定为标准 stack: heroku-16 heroku-18(ubuntu 16.04 ubuntu 16.08),其他为<code>container</code></p> <h3 id="heroku-yaml"><a href="#heroku-yaml" aria-hidden="true" class="header-anchor">#</a> heroku.yaml</h3> <p>定义 Docker image 如何编译，以及启动方式，需要配置你的 <code>stack</code> 为 <code>container</code>，可以在<code>build</code>中配置<code>config</code>的值设置<code>Dockerfile</code>中的<code>ARG</code>字段，可以配置多<code>target</code>，同时配置 <code>release</code> 的类型对应哪个target</p> <h4 id="setup"><a href="#setup" aria-hidden="true" class="header-anchor">#</a> setup</h4> <p>通过 <code>heroku.yaml.setup</code> 可以直接布置一个你的初始应用状态，包括 <code>addons</code> 和 <code>config var</code>(这个用来干嘛的没看到)</p> <h3 id="build-packs"><a href="#build-packs" aria-hidden="true" class="header-anchor">#</a> Build Packs</h3> <p>keroku 提供官方的标准 <code>buildpack</code>，可以配置相关的参数，比如 golang 中的 CGO_LDFALGS 什么的，如果不添加任何 <code>buildpack</code> 配置，将会使用默认的检测工具检查代码属于什么语言类型，找到对应的编译语言后使用官方标准编译相关代码，默认官方提供的 <code>buildpack</code> 是 <code>latest</code>，如果要使用某个固定版本的，需要直接指定对应的 <code>buildpack</code> full url（仓库地址）, 编译使用的base image 为 <code>STACK</code></p> <p>一个 <code>app</code> 可以指定多个 buildpack: <code>heroku buildpacks:add --index 1 heroku/go</code></p> <p>支持三方 buildpack ,通过官方提供的 buildpack 平台查找或者使用某个符合 heroku buildpack 规则的 git 仓库可以指定需要使用的三方 buildpack，支持仓库的 tag 或者 branch 指定某个 buildpack 的版本</p> <p>buildpack 指定三个的 script</p> <ul><li><code>bin/detect</code>: 校验编译准备的合法性，比如是否存在什么东西，什么变量</li> <li><code>bin/compile</code>: 执行一些前期准备之类的东西</li> <li><code>bin/release</code>: 提供 meta 信息用于执行期</li></ul> <h4 id="bin-detect-build-dir"><a href="#bin-detect-build-dir" aria-hidden="true" class="header-anchor">#</a> bin/detect BUILD_DIR</h4> <p>脚本执行必须返回 <code>0</code> 才算作成功，同时从 <code>stdout</code> 应当输出明确的 framwork 名称</p> <h4 id="bin-compile-build-dir-cache-dir-env-dir"><a href="#bin-compile-build-dir-cache-dir-env-dir" aria-hidden="true" class="header-anchor">#</a> bin/compile BUILD_DIR CACHE_DIR ENV_DIR</h4> <p>实际编译过程，<code>BUILD_DIR</code> 是 app 编译目录， <code>CACHE_DIR</code> 是缓存或者长线编译过程中的中间产物，每次编译都会用到这些东西， <code>ENV_DIR</code> 包含了应用的配置变量，可以通过 <code>Profile</code> 将其内容转变为 <code>env</code> 变量，<code>ENV_DIR</code> 中一个文件的文件名是变量名，文件内容是变量的值， 标准 <code>env</code> 仅提供 <code>STACK</code> 和 <code>SOURCE_VERSION</code> 两个基本信息，应当在任何主要步骤执行前明确的使用 <code>-----&gt;</code> 6-char arrow 显示执行的步骤</p> <h4 id="bin-release-build-dir"><a href="#bin-release-build-dir" aria-hidden="true" class="header-anchor">#</a> bin/release BUILD_DIR</h4> <p>两个字段:</p> <ul><li>addons: []string, 需要添加的addon(会在app之前完成)</li> <li>default_process_types: 默认的 <code>Procfile</code> 入口，比如： web: bin/node server.js 当然也可以写<code>Procfile</code>指定而不写这个</li></ul> <h4 id="procfile"><a href="#procfile" aria-hidden="true" class="header-anchor">#</a> Procfile</h4> <p>主目录下的名为 <code>Procfile</code> 的文件，定义应用类型以及对应的执行入口</p> <h4 id="profile-d-profile"><a href="#profile-d-profile" aria-hidden="true" class="header-anchor">#</a> .profile.d/.profile</h4> <p>开始<code>release</code>之前会通过一个 bash shell <code>soruce .profile.d/*.sh</code> 执行所有的shell 文件, 然后执行 <code>.profile</code> 文件</p></div><div class="list-item"><div class="divider"></div><div class="post-footer">&lt;- back</div><div class="post-footer">&lt;- back to home</div></div></section><footer class="footer">
  © 2021
  <!---->
  
  <br>
  Powered by
  <a href="https://vuepress.vuejs.org/" rel="noopener" target="_blank">VuePress</a>
  | Theme, Customized from
  <a href="https://github.com/viko16/vuepress-theme-simple" rel="noopener" target="_blank">Simple</a></footer></div><!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.52eaae7e.js" defer></script><script src="/assets/js/2.6d9f343b.js" defer></script><script src="/assets/js/13.79df7d96.js" defer></script>
  </body>
</html>
