<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kustomize | zkcrescent 的木屋</title>
    <meta name="description" content="一个莫得感情的代码工具人">
    
    
    <link rel="preload" href="/assets/css/0.styles.5ba0d270.css" as="style"><link rel="preload" href="/assets/js/app.504232ce.js" as="script"><link rel="preload" href="/assets/js/2.6d9f343b.js" as="script"><link rel="preload" href="/assets/js/7.bf86fcc7.js" as="script"><link rel="prefetch" href="/assets/js/10.8b6cd506.js"><link rel="prefetch" href="/assets/js/11.7a3b4b61.js"><link rel="prefetch" href="/assets/js/12.f053e55b.js"><link rel="prefetch" href="/assets/js/13.09240097.js"><link rel="prefetch" href="/assets/js/14.938cb481.js"><link rel="prefetch" href="/assets/js/15.784390ce.js"><link rel="prefetch" href="/assets/js/16.6250e79b.js"><link rel="prefetch" href="/assets/js/17.7f8f5315.js"><link rel="prefetch" href="/assets/js/18.a7799356.js"><link rel="prefetch" href="/assets/js/19.40859ebb.js"><link rel="prefetch" href="/assets/js/20.eebf7fb8.js"><link rel="prefetch" href="/assets/js/3.814f06c8.js"><link rel="prefetch" href="/assets/js/4.da136bfd.js"><link rel="prefetch" href="/assets/js/5.933f8abe.js"><link rel="prefetch" href="/assets/js/6.58791e56.js"><link rel="prefetch" href="/assets/js/8.fcbdd320.js"><link rel="prefetch" href="/assets/js/9.ee1af625.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5ba0d270.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container vuepress-theme-simple"><header class="header"><a href="/" title="一个莫得感情的代码工具人" class="site-name router-link-active">zkcrescent 的木屋</a><div style="clear: both"></div><div class="navbar"><span><a href="/components/technic/golang/main.html" class="navbar-item">GoLang 相关</a><!----></span><span><a href="/components/technic/os/main.html" class="navbar-item">OS 相关</a><!----></span><span><a href="/components/technic/store/main.html" class="navbar-item">存储相关</a><!----></span><span><a href="/components/technic/link.html" class="navbar-item">知识链接</a><!----></span><span><a href="/intro.html" class="navbar-item">关于</a><!----></span></div></header><section class="post-view"><div class="post-head"><h1 class="post-title">kustomize</h1><time datetime="9/2/2019" title="9/2/2019" pubdate="pubdate" class="post-date">
  3 months ago
</time></div><div class="content__default"><h1 id="kustomize"><a href="#kustomize" aria-hidden="true" class="header-anchor">#</a> kustomize</h1> <p>根据 <code>Declarative Application Management(可定义的应用管理工具)</code> 的思想实现的管理 K8S 集群的一套最佳实践, 音同 <code>customize</code></p> <h2 id="主要特点"><a href="#主要特点" aria-hidden="true" class="header-anchor">#</a> 主要特点</h2> <ul><li>可做任何类型的配置，包括定制的，现成的，有状态的，无状态的</li> <li>支持普遍性的自定义（应该翻译成符合标准的全部自定义），记录每次创建的版本</li> <li>暴露原生的 k8s API，而不出隐藏掉</li> <li>平滑的版本控制和迁移，支持审计检查</li> <li>同其他工具联合时能够感觉像是一体的（ 与其他工具的联合时契合度较高 ）</li> <li>回避模板中的交叉重复和领域中语言特殊性等等问题（解释：模板重复，语言限制）</li></ul> <div class="tip custom-block"><p class="custom-block-title">DAM</p> <p>The central idea is that a toolbox of composable configuration tools should manipulate configuration data in the form of declarative API resource specifications, which serve as a <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/architecture/declarative-application-management.md" target="_blank" rel="noopener noreferrer">declarative data model<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, not express configuration as code or some other representation that is restrictive, non-standard, and/or difficult to manipulate.</p></div> <div class="warning custom-block"><p>配置的有无状态应该是只配置文件是否依赖其他，比如istio依赖envoy，没有看到详细说明 <br>
暴露 k8s API是指 kustomize 在更新配置的时候先生成一份 k8s 的标准配置文件然后 apply</p></div> <h2 id="使用方式"><a href="#使用方式" aria-hidden="true" class="header-anchor">#</a> 使用方式</h2> <p><code>kustomization</code> + <code>patches</code> + <code>resources</code></p> <h3 id="基础：-kustomization-kustomization-yaml"><a href="#基础：-kustomization-kustomization-yaml" aria-hidden="true" class="header-anchor">#</a> 基础： kustomization ( kustomization.yaml )</h3> <p>应用部署的集合定义，包括 <code>label</code>, <code>resource</code>, <code>configMap</code>, <code>secret</code> 等，相当于程序中的 command 部分(包括 main 和 subcommand)，提供最终目标（需要一个什么样的东西）</p> <h3 id="组件：patches"><a href="#组件：patches" aria-hidden="true" class="header-anchor">#</a> 组件：patches</h3> <p>相当于写代码的某个package，可以被 <code>kustomization</code> 引用, 用于完善内容, 比如可以定义 <code>deploment</code> 的 <code>replias</code>, <code>deploment</code> 中的 <code>containers</code></p> <h3 id="资源-resources"><a href="#资源-resources" aria-hidden="true" class="header-anchor">#</a> 资源: resources</h3> <p>定义基础的需求类型，比如 <code>deploment</code>, <code>ds</code>, <code>pod</code>, <code>service</code> 等等 k8s 的相关资源定义, 可以被 <code>kustomization</code> 引用，相当于程序 cmd 的不同参数</p> <h2 id="示例"><a href="#示例" aria-hidden="true" class="header-anchor">#</a> 示例</h2> <p><img src="/img/kustomize-kr.jpg" alt="K+R"></p> <p><img src="/img/kustomize-example.jpg" alt="K+P+R"></p> <h5 id="这篇文章的来由"><a href="#这篇文章的来由" aria-hidden="true" class="header-anchor">#</a> 这篇文章的来由</h5> <p>因为考虑做阿里云（基于K8S）产线的一些针对中小企业的产品，然后从市面上寻找了几个知名的管理工具，包括了<code>heroku</code>,<code>open shift</code>, <code>kustomize</code>, <code>helm</code>，然后我主要负责 <code>kustomize</code> 相关的情况了解和以及做一些总结用于会议交流，于是有了这篇文章</p></div><div class="list-item"><div class="divider"></div><div class="post-footer">&lt;- back</div><div class="post-footer">&lt;- back to home</div></div></section><footer class="footer">
  © 2019
  <!---->
  
  <br>
  Powered by
  <a href="https://vuepress.vuejs.org/" rel="noopener" target="_blank">VuePress</a>
  | Theme, Customized from
  <a href="https://github.com/viko16/vuepress-theme-simple" rel="noopener" target="_blank">Simple</a></footer></div><!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.504232ce.js" defer></script><script src="/assets/js/2.6d9f343b.js" defer></script><script src="/assets/js/7.bf86fcc7.js" defer></script>
  </body>
</html>
